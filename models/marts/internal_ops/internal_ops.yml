version: 2

models:
  - name: prep_followup_analysis
    description: |
      **Feature Engineering for Follow-Up Completion Prediction**
      
      Prepares analytical dataset for logistic regression modeling to predict whether members 
      will complete required follow-up after abnormal screening results.
      
      **Business Question:** "Will a member complete their follow-up within 60 days?"
      
      **Use Case:**
      - Identify high-risk members for proactive outreach
      - Optimize care coordinator resource allocation
      - Reduce care gaps and improve patient outcomes
      
      **Statistical Approach:**
      - Model: Logistic regression (binary classification)
      - Outcome: follow_up_completed (1 = completed within 60 days, 0 = not completed)
      - Sample size: 386 screenings requiring follow-up
      - Train/test split: 75%/25%
      
      **Predictors (5 features):**
      1. age_group (categorical: Under 40, 40-49, 50-64, 65+)
      2. gender (categorical: M, F, Other)
      3. screening_type (categorical: Mammogram, Colonoscopy, Prostate, Cervical, Other)
      4. days_to_result (continuous: turnaround time for results)
      5. day_of_week_result_delivered (categorical: Monday-Sunday)
      
      **Feature Engineering:**
      - One-hot encoding for categorical variables
      - Standardization of continuous variable (days_to_result)
      - Reference categories: Under 40, Male, Mammogram, Monday
      
      **Grain:** One row per screening requiring follow-up
      
      **Refresh Frequency:** Daily (table materialization)
    columns:
      - name: screening_id
        description: "Unique screening identifier"
        tests:
          - not_null
          - unique
      - name: outcome
        description: "Binary outcome variable: TRUE if follow-up completed within 60 days, FALSE otherwise"
      - name: outcome_binary
        description: "Numeric encoding of outcome (1 = completed, 0 = not completed) for modeling"
      - name: age_group
        description: "Member age segment - predictor variable"
      - name: gender
        description: "Member gender - predictor variable"
      - name: screening_type
        description: "Type of screening performed - predictor variable"
      - name: days_to_result
        description: "Days from screening to result delivery (continuous) - predictor variable"
      - name: day_of_week_result_delivered
        description: "Day of week results were delivered - predictor variable"
      - name: age_under_40
        description: "One-hot encoded: 1 if Under 40, 0 otherwise"
      - name: age_40_49
        description: "One-hot encoded: 1 if 40-49, 0 otherwise"
      - name: age_50_64
        description: "One-hot encoded: 1 if 50-64, 0 otherwise"
      - name: age_65_plus
        description: "One-hot encoded: 1 if 65+, 0 otherwise"

  - name: analysis_followup_descriptive
    description: |
      **Descriptive Statistics - Follow-Up Completion by Segment**
      
      Univariate analysis showing follow-up completion rates segmented by each predictor variable.
      Used for exploratory data analysis before modeling and for validating model findings.
      
      **Business Value:**
      - Identify demographic/operational patterns in follow-up behavior
      - Validate statistical model results against descriptive patterns
      - Inform targeted intervention strategies
      
      **Segments:**
      - Overall completion rate
      - By age group
      - By gender
      - By screening type
      - By day of week (result delivery)
      - By days to result (binned: â‰¤7, 8-14, 15-21, >21 days)
      
      **Grain:** One row per segment (segment_type - segment_value)
    columns:
      - name: segment_type
        description: "Dimension being analyzed: 'Overall', 'Age Group', 'Gender', 'Screening Type', 'Day of Week', 'Days to Result'"
        data_tests:
          - not_null
          - accepted_values:
              values: ['Overall', 'Age Group', 'Gender', 'Screening Type', 'Day of Week', 'Days to Result']
      - name: segment_value
        description: "Specific value within the dimension (e.g., 'Under 40' for Age Group, 'Mammogram' for Screening Type)"
        data_tests:
          - not_null
      - name: total_records
        description: "Number of screenings requiring follow-up in this segment"
        data_tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: "> 0"
      - name: completed
        description: "Number of follow-ups completed in this segment"
        data_tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
          - dbt_utils.expression_is_true:
              expression: "<= total_records"
              config:
                error_if: ">0"
                warn_if: ">0"
      - name: completion_rate_pct
        description: "Percentage of follow-ups completed (completed / total_records * 100)"
        data_tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0 AND <= 100"
      - name: calculated_at
        description: "Timestamp when statistics were calculated"
        data_tests:
          - not_null
  
  - name: mart_followup_risk_prediction
    description: |
      **Follow-Up Completion Risk Prediction (Operational Mart)**
      
      Logistic regression model predictions for follow-up completion likelihood, with risk scoring 
      and prioritization for operational use by care coordination teams.
      
      **Model Performance (Test Set):**
      - Accuracy: 82.5%
      - Precision: 82.5%
      - Recall: 100%
      - F1-Score: 0.904
      - ROC-AUC: 0.586
      
      **Key Model Findings:**
      
      *Factors DECREASING follow-up completion:*
      - Other screening types (OR: 0.37) - 63% less likely to complete
      - Cervical screenings (OR: 0.38) - 62% less likely to complete
      - Results on Friday (OR: 0.42) - 58% less likely to complete
      - Results on Saturday (OR: 0.57) - 43% less likely to complete
      
      *Factors INCREASING follow-up completion:*
      - Colonoscopy screenings (OR: 1.99) - 99% more likely to complete
      
      **Business Interpretation:**
      - Colonoscopy patients are highly motivated (cancer risk awareness)
      - Friday/weekend results get lost (lower portal engagement)
      - Cervical screening patients need extra engagement
      
      **Operational Use:**
      - **Tier 1 (Critical):** Members with <40% predicted completion - immediate outreach
      - **Tier 2 (Standard):** Members with 40-70% predicted completion - scheduled outreach
      - **Tier 3 (Monitor):** Members with >70% predicted completion - automated reminders only
      
      **Grain:** One row per screening requiring follow-up
      
      **Refresh Frequency:** Daily (predictions re-run on new screenings)
    columns:
      - name: screening_id
        description: "Unique screening identifier"
        tests:
          - not_null
          - unique
      - name: member_id
        description: "Member identifier for outreach"
      - name: actual_completed
        description: "Actual outcome: whether follow-up was completed"
      - name: predicted_completion_probability
        description: "Model-predicted probability of follow-up completion (0.0-1.0)"
      - name: predicted_completed
        description: "Binary prediction: TRUE if model predicts completion, FALSE otherwise"
      - name: risk_category
        description: "Risk classification: High/Medium/Low Risk based on predicted probability"
      - name: non_completion_risk_score
        description: "Risk score 0-100 where higher = more likely to NOT complete (100 - predicted_probability * 100)"
      - name: outreach_priority
        description: |
          Operational prioritization tier:
          - Tier 1 - Critical Outreach: <40% completion probability - immediate action needed
          - Tier 2 - Standard Outreach: 40-70% completion probability - scheduled follow-up
          - Tier 3 - Monitor Only: >70% completion probability - automated reminders sufficient
      - name: screening_type
        description: "Type of screening (context for risk score interpretation)"
      - name: day_of_week_result_delivered
        description: "Day results were delivered (context for risk score interpretation)"

  - name: analysis_followup_risk_summary
    description: |
      **Follow-Up Risk Model - Executive Summary**
      
      High-level summary of logistic regression model performance, risk distribution, 
      and high-risk member profiles for executive dashboards and model monitoring.
      
      **Metrics Included:**
      - Overall model performance (accuracy, prediction volume)
      - Risk tier distribution (how many in each priority tier)
      - High-risk member profile (characteristics of Tier 1 members)
      - Model calibration (actual completion rates by predicted risk category)
      
      **Business Value:**
      - Monitor model performance over time
      - Track operational impact (members reached by tier)
      - Validate model assumptions (calibration check)
      - Inform resource planning (volume by priority tier)
      
      **Grain:** One row per metric
      
      **Refresh Frequency:** Daily
    columns:
      - name: metric_category
        description: "Category of metric: Overall Model Performance, Risk Distribution, High Risk Profile, Model Calibration"
      - name: metric_name
        description: "Specific metric name within category"
      - name: metric_value
        description: "Metric value (formatted as string for mixed data types)"